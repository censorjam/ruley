{
    "debug": true,

    "globals": {
        "type": "rabbitmq"
    },

    "parameters": [
        {
            "name": "rabbitmq events",
            "host": "localhost",
            "port": 15672,
            "vhost": "events",
            "authentication": {
                "username": "guest",
                "password": "guest"
            }
        },
        {
            "name": "rabbitmq core",
            "host": "rmq001",
            "port": 15672,
            "vhost": "sdffd",
            "authentication": {
                "username": "guest",
                "password": "guest"
            }
        }
    ],

    "template": {
        "input": {
            "$type": "Ruley.Core.Inputs.PollingInput, Ruley",
            "interval": 5000
        },

        "filters": [
            {
                "$type": "@template",
                "template": "http://{host}:{port}/api/aliveness-test/{vhost}",
                "destination": "url"
            },
            {
                "$type": "@http",
                "url": "{url}",
                "username": "{authentication.username}",
                "password": "{authentication.password}",
                "authentication": "basic",
                "timeout": 5000
            },
            {
                "$type": "@map",
                "field": "statusCode",
                "destination": "status",
                "mapping": [
                    [ 200, "Healthy" ]
                ],
                "map": [
                    {
                        "in": 200,
                        "out": {
                            "status": "Healthy"
                        }
                    }
                ],
                "default": "Unhealthy"
            },
            {
                "$type": "@distinct",
                "value": "{status}"
            },
            {
                "$type": "@merge",
                "data": {
                    "type": "rabbitmq",
                    "info": "Status Code: {statusCode}\nUrl: {url}\nException: {exception}"
                }
            },
            {
                "$type": "@bus.pub",
                "key": "health-check"
            }
        ],

        "outputs": [
            {
                "$type": "@console",
                "enabled": true
            }
        ]
    }
}
